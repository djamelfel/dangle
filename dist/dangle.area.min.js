/*! dangle - v1.0.0 - 2014-10-17
* http://www.fullscale.co/dangle
* Copyright (c) 2014 FullScale Labs, LLC; Licensed MIT */
angular.module("dangle").directive("fsArea",[function(){"use strict";return{restrict:"E",scope:{onClick:"=",width:"=",height:"=",bind:"=",label:"@",field:"@",duration:"@",delay:"@",plot:"@",pointRadius:"@"},link:function(e,t,n){var r={top:20,right:20,bottom:80,left:80},i=e.width||1280,s=e.height||300,o=n.interpolate||"false",u=n.label||"Frequency",a=n.class||"";i=i-r.left-r.right,s=s-r.top-r.bottom;var f=d3.time.scale().range([0,i]),l=d3.scale.linear().range([s,0]),c=d3.svg.axis().scale(f).orient("bottom"),h=d3.svg.axis().scale(l).orient("left"),p=d3.svg.line().x(function(e){return f(e.time)}).y(function(e){return l(e.count)}),d=d3.svg.area().x(function(e){return f(e.time)}).y0(s).y1(function(e){return l(e.count)});n.interpolate=="true"&&(p.interpolate("cardinal"),d.interpolate("cardinal"));var v=d3.select(t[0]).append("svg").attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+(i+r.left+r.right)+" "+(s+r.top+r.bottom)).append("g").attr("transform","translate("+r.left+","+r.top+")");v.append("g").attr("class","area x axis "+a).attr("transform","translate(0,"+s+")").call(c),v.append("g").attr("class","area y axis "+a).call(h).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text(u),e.$watch("bind",function(t){var r=e.duration||0,i=e.delay||0,s=e.plot||"true",o=e.pointRadius||8,u=e.field||n.bind.split(".").pop().toLowerCase();if(t){t=t.entries||[];var m={};for(var g=0;g<t.length;g++)m[t[g].label]===undefined&&(m[t[g].label]=[]),m[t[g].label].push(t[g]);var b=0;for(var w in m){v.append("path").datum([]).attr("class","fill fill"+b+" curve"+b+" "+a).attr("d",d),v.append("path").datum([]).attr("class","line line"+b+" curve"+b+" "+a).attr("d",p),f.domain(d3.extent(t,function(e){return e.time}));var E=d3.min(t,function(e){return e.count});E<0?E:E=0,l.domain([E,d3.max(t,function(e){return e.count})]);var S=v.transition().duration(r);S.select(".fill"+b).attr("d",d(m[w])),S.select(".line"+b).attr("d",p(m[w])),v.append("circle").attr("cx",b*100).attr("cy",250).attr("r",8).attr("class","curve"+b),v.append("text").attr("x",b*100+12).attr("y",255).attr("class","curve"+b).text(w);if(s=="true"){var T=v.selectAll("circle").data(t.filter(function(e){return e.count}),function(e){return Math.random()});T.enter().append("circle").attr("class","area line points "+a).attr("cursor","pointer").attr("cx",p.x()).attr("cy",p.y()).style("opacity",0).transition().duration(r).style("opacity",1).attr("cx",p.x()).attr("cy",p.y()).attr("r",o),T.on("mousedown",function(t){e.$apply(function(){(e.onClick||angular.noop)(u,t.time)})}),T.exit().remove()}S.select(".x").call(c),S.select(".y").call(h),b++}}},!0)}}}]);